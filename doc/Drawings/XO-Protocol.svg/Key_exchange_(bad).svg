<?xml version="1.0"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xl="http://www.w3.org/1999/xlink" version="1.1" viewBox="0 0 559 783" width="559pt" height="783pt"><metadata xmlns:dc="http://purl.org/dc/elements/1.1/"><dc:date>2014-04-10 12:12Z</dc:date><!-- Produced by OmniGraffle Professional 5.4.4 --></metadata><defs><filter id="Shadow" filterUnits="userSpaceOnUse"><feGaussianBlur in="SourceAlpha" result="blur" stdDeviation="3.488"/><feOffset in="blur" result="offset" dx="0" dy="4"/><feFlood flood-color="black" flood-opacity=".75" result="flood"/><feComposite in="flood" in2="offset" operator="in"/></filter><font-face font-family="Helvetica" font-size="12" units-per-em="1000" underline-position="-75.683594" underline-thickness="49.316406" slope="0" x-height="532.22656" cap-height="719.72656" ascent="770.01953" descent="-229.98047" font-weight="bold"><font-face-src><font-face-name name="Helvetica-Bold"/></font-face-src></font-face><marker orient="auto" overflow="visible" markerUnits="strokeWidth" id="StickArrow_Marker" viewBox="-1 -6 14 12" markerWidth="14" markerHeight="12" color="black"><g><path d="M 11.428568 0 L 0 0 M 0 -4.285713 L 11.428568 0 L 0 4.285713" fill="none" stroke="currentColor" stroke-width="1"/></g></marker><font-face font-family="Helvetica" font-size="10" units-per-em="1000" underline-position="-75.683594" underline-thickness="49.316406" slope="0" x-height="522.94922" cap-height="717.28516" ascent="770.01953" descent="-229.98047" font-weight="500"><font-face-src><font-face-name name="Helvetica"/></font-face-src></font-face><marker orient="auto" overflow="visible" markerUnits="strokeWidth" id="HalfStickArrow_Marker" viewBox="-1 -1 14 7" markerWidth="14" markerHeight="7" color="black"><g><path d="M 11.428568 0 L 0 0 M 0 4.285713 L 11.428568 0" fill="none" stroke="currentColor" stroke-width="1"/></g></marker><font-face font-family="Helvetica" font-size="12" units-per-em="1000" underline-position="-75.683594" underline-thickness="49.316406" slope="0" x-height="522.94922" cap-height="717.28516" ascent="770.01953" descent="-229.98047" font-weight="500"><font-face-src><font-face-name name="Helvetica"/></font-face-src></font-face></defs><g stroke="none" stroke-opacity="1" stroke-dasharray="none" fill="none" fill-opacity="1"><title>Key exchange (bad)</title><rect fill="white" width="559" height="783"/><g><title>Layer 1</title><g><use xl:href="#id4_Graphic" filter="url(#Shadow)"/><use xl:href="#id40_Graphic" filter="url(#Shadow)"/><use xl:href="#id47_Graphic" filter="url(#Shadow)"/><use xl:href="#id48_Graphic" filter="url(#Shadow)"/><use xl:href="#id53_Graphic" filter="url(#Shadow)"/><use xl:href="#id26_Graphic" filter="url(#Shadow)"/><use xl:href="#id58_Graphic" filter="url(#Shadow)"/><use xl:href="#id71_Graphic" filter="url(#Shadow)"/><use xl:href="#id72_Graphic" filter="url(#Shadow)"/></g><rect x="58" y="59.999954" width="108" height="41.628937" fill="white"/><rect x="58" y="59.999954" width="108" height="41.628937" stroke="black" stroke-linecap="round" stroke-linejoin="round" stroke-width="1"/><text transform="translate(63 73.814422)" fill="black"><tspan font-family="Helvetica" font-size="12" font-weight="bold" x="28.65918" y="11" textLength="40.68164">Sender</tspan></text><line x1="112" y1="102.12889" x2="112" y2="595.22913" stroke="black" stroke-linecap="round" stroke-linejoin="round" stroke-width="1" stroke-dasharray="4,4"/><rect x="233.33331" y="59.999985" width="108" height="41.628937" fill="white"/><rect x="233.33331" y="59.999985" width="108" height="41.628937" stroke="black" stroke-linecap="round" stroke-linejoin="round" stroke-width="1"/><text transform="translate(238.33331 73.814454)" fill="black"><tspan font-family="Helvetica" font-size="12" font-weight="bold" x="30.317383" y="11" textLength="37.365234">Server</tspan></text><line x1="287.33331" y1="102.12892" x2="287.33331" y2="595.22925" stroke="black" stroke-linecap="round" stroke-linejoin="round" stroke-width="1" stroke-dasharray="4,4"/><rect x="417.33334" y="59.999985" width="108" height="41.628937" fill="white"/><rect x="417.33334" y="59.999985" width="108" height="41.628937" stroke="black" stroke-linecap="round" stroke-linejoin="round" stroke-width="1"/><text transform="translate(422.33334 73.814454)" fill="black"><tspan font-family="Helvetica" font-size="12" font-weight="bold" x="23.980469" y="11" textLength="50.039062">Receiver</tspan></text><line x1="471.33334" y1="102.12892" x2="471.33334" y2="595.22937" stroke="black" stroke-linecap="round" stroke-linejoin="round" stroke-width="1" stroke-dasharray="4,4"/><g id="id4_Graphic"><rect x="103.5" y="138.95767" width="17" height="71.41803" fill="white"/><rect x="103.5" y="138.95767" width="17" height="71.41803" stroke="black" stroke-linecap="round" stroke-linejoin="round" stroke-width="1"/></g><line x1="120.5" y1="156.81218" x2="269.75475" y2="156.67862" marker-end="url(#StickArrow_Marker)" stroke="black" stroke-linecap="round" stroke-linejoin="round" stroke-width="1"/><text transform="translate(146.4968 139.82747)" fill="black"><tspan font-family="Helvetica" font-size="10" font-weight="500" x="0" y="10" textLength="116.171875">updatePresence(…,keyId)</tspan></text><g id="id40_Graphic"><rect x="278.83331" y="156.66669" width="17" height="47.424454" fill="white"/><rect x="278.83331" y="156.66669" width="17" height="47.424454" stroke="black" stroke-linecap="round" stroke-linejoin="round" stroke-width="1"/></g><line x1="278.83331" y1="192.23503" x2="133.828545" y2="192.4971" marker-end="url(#StickArrow_Marker)" stroke="black" stroke-linecap="round" stroke-linejoin="round" stroke-width="1" stroke-dasharray="1,4"/><text transform="translate(163.44946 175.46488)" fill="black"><tspan font-family="Helvetica" font-size="10" font-weight="500" x="0" y="10" textLength="76.69922">return(presence) </tspan></text><g id="id47_Graphic"><rect x="278.83331" y="244.98003" width="17" height="47.424454" fill="white"/><rect x="278.83331" y="244.98003" width="17" height="47.424454" stroke="black" stroke-linecap="round" stroke-linejoin="round" stroke-width="1"/></g><line x1="296.33327" y1="192.22867" x2="453.75586" y2="190.22553" marker-end="url(#HalfStickArrow_Marker)" stroke="black" stroke-linecap="round" stroke-linejoin="round" stroke-width="1"/><text transform="translate(301.37151 170.51089)" fill="black"><tspan font-family="Helvetica" font-size="10" font-weight="500" x="0" y="10" textLength="173.97461">presenceUpdated(…,client,[keyId,Key])</tspan></text><g id="id48_Graphic"><rect x="462.83334" y="190.05594" width="17" height="90.924103" fill="white"/><rect x="462.83334" y="190.05594" width="17" height="90.924103" stroke="black" stroke-linecap="round" stroke-linejoin="round" stroke-width="1"/></g><g id="id53_Graphic"><rect x="103.5" y="244.97998" width="17" height="47.424454" fill="white"/><rect x="103.5" y="244.97998" width="17" height="47.424454" stroke="black" stroke-linecap="round" stroke-linejoin="round" stroke-width="1"/></g><g id="id26_Graphic"><path d="M 279.5 192.66669 L 284.48177 192.66669 C 286.97265 192.66669 289.46353 188.16669 289.46353 174.66669 C 289.46353 161.16669 286.97265 156.66669 284.48177 156.66669 L 279.5 156.66669 Z" fill="white"/><path d="M 279.5 192.66669 L 284.48177 192.66669 C 286.97265 192.66669 289.46353 188.16669 289.46353 174.66669 C 289.46353 161.16669 286.97265 156.66669 284.48177 156.66669 L 279.5 156.66669 Z" stroke="black" stroke-linecap="round" stroke-linejoin="round" stroke-width="1"/></g><line x1="462.83334" y1="243.23698" x2="304.91118" y2="244.84437" marker-end="url(#StickArrow_Marker)" stroke="black" stroke-linecap="round" stroke-linejoin="round" stroke-width="1"/><text transform="translate(334.02804 227.17524)" fill="black"><tspan font-family="Helvetica" font-size="10" font-weight="500" x="0" y="10" textLength="90.595703">getKey(client, keyId)</tspan></text><g id="id58_Graphic"><path d="M 295.83331 244.98003 L 290.85155 244.98003 C 288.36066 244.98003 285.86978 249.48003 285.86978 262.98003 C 285.86978 276.48003 288.36066 280.98003 290.85155 280.98003 L 295.83331 280.98003 Z" fill="white"/><path d="M 295.83331 244.98003 L 290.85155 244.98003 C 288.36066 244.98003 285.86978 249.48003 285.86978 262.98003 C 285.86978 276.48003 288.36066 280.98003 290.85155 280.98003 L 295.83331 280.98003 Z" stroke="black" stroke-linecap="round" stroke-linejoin="round" stroke-width="1"/></g><line x1="295.83331" y1="280.54837" x2="449.5049" y2="279.87123" marker-end="url(#StickArrow_Marker)" stroke="black" stroke-linecap="round" stroke-linejoin="round" stroke-width="1" stroke-dasharray="1,4"/><text transform="translate(349.5875 263.2569)" fill="black"><tspan font-family="Helvetica" font-size="10" font-weight="500" x="0" y="10" textLength="65.024414">return(keyInfo)</tspan></text><line x1="120.5" y1="245.51822" x2="242.8381" y2="245.54125" marker-end="url(#StickArrow_Marker)" stroke="black" stroke-linecap="round" stroke-linejoin="round" stroke-width="1"/><text transform="translate(143.01804 228.6224)" fill="black"><tspan font-family="Helvetica" font-size="10" font-weight="500" x="0" y="10" textLength="66.708984">updateKey(key</tspan><tspan font-family="Helvetica" font-size="10" font-weight="500" x="65.97168" y="10" textLength="30.009766">,keyId)</tspan></text><g id="id71_Graphic"><rect x="256.66666" y="245.54465" width="17" height="47.424454" fill="white"/><rect x="256.66666" y="245.54465" width="17" height="47.424454" stroke="black" stroke-linecap="round" stroke-linejoin="round" stroke-width="1"/></g><g id="id72_Graphic"><path d="M 257.33331 281.54465 L 262.31508 281.54465 C 264.80596 281.54465 267.29684 277.04465 267.29684 263.54465 C 267.29684 250.04465 264.80596 245.54465 262.31508 245.54465 L 257.33331 245.54465 Z" fill="white"/><path d="M 257.33331 281.54465 L 262.31508 281.54465 C 264.80596 281.54465 267.29684 277.04465 267.29684 263.54465 C 267.29684 250.04465 264.80596 245.54465 262.31508 245.54465 L 257.33331 245.54465 Z" stroke="black" stroke-linecap="round" stroke-linejoin="round" stroke-width="1"/></g><line x1="256.66666" y1="280.08072" x2="133.828464" y2="280.24808" marker-end="url(#StickArrow_Marker)" stroke="black" stroke-linecap="round" stroke-linejoin="round" stroke-width="1" stroke-dasharray="1,4"/><text transform="translate(166.04858 263.26169)" fill="black"><tspan font-family="Helvetica" font-size="10" font-weight="500" x="0" y="10" textLength="48.34961">return(null)</tspan></text><text transform="translate(58 26)" fill="black"><tspan font-family="Helvetica" font-size="12" font-weight="500" x=".265625" y="11" textLength="291.46875">Key Exchange (current partially wrong implementation)</tspan></text><ellipse cx="276.33331" cy="270.90577" rx="43.000069" ry="56.594315" stroke="#ff0006" stroke-linecap="round" stroke-linejoin="round" stroke-width="1"/><text transform="translate(236.5 333.29337)" fill="red"><tspan font-family="Helvetica" font-size="12" font-weight="500" fill="red" x=".30859375" y="11" textLength="85.38281">Race Condition!</tspan></text></g></g></svg>
